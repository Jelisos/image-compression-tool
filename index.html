<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO 优化的标题 -->
    <title>Jelisos - 免费批量图片压缩工具 | 极速高质量压缩</title>
    
    <!-- 添加描述标签 -->
    <meta name="description" content="Jelisos 提供免费批量图片压缩服务，极速处理，保持高质量效果。在浏览器中压缩图片，保护隐私，无需上传至服务器。">
    
    <!-- 添加关键词标签 -->
    <meta name="keywords" content="Jelisos, 免费图片压缩, 批量图片处理, 极速压缩, 高质量压缩, 在线图片工具, 图片优化">
    
    <!-- 添加作者标签 -->
    <meta name="author" content="Jelisos">
    
    <!-- Open Graph 标签(社交媒体分享优化) -->
    <meta property="og:title" content="Jelisos - 免费批量图片压缩工具 | 极速高质量压缩">
    <meta property="og:description" content="Jelisos 提供免费批量图片压缩服务，极速处理，保持高质量效果。在浏览器中压缩图片，保护隐私。">
    <meta property="og:url" content="https://jelisos.github.io/image-compression-tool/">
    <meta property="og:type" content="website">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="share.css">
    
    <!-- 添加网站图标 -->
    <link rel="icon" type="image/png" href="icons/favicon.png">
    <link rel="canonical" href="https://jelisos.github.io/image-compression-tool/">
    
    <!-- 添加Web App清单引用 -->
    <link rel="manifest" href="manifest.json">
    
    <!-- 添加iOS支持的元标签 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="图片压缩">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    
    <!-- 添加Windows磁贴支持 -->
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#4a90e2">

    <!-- PWA相关元标签 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="图片压缩">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    
    <!-- 关键 CSS（内联） -->
    <style>
        /* 这里放置关键路径 CSS，保持页面初始渲染不闪烁 */
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
    </style>
    
    <!-- 预加载重要资源 -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="libs/browser-image-compression.min.js" as="script">
    
    <!-- 延迟加载非关键 CSS -->
    <link rel="stylesheet" href="styles.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="share.css" media="print" onload="this.media='all'">
    
    <!-- 备用方案，确保 CSS 会被加载 -->
    <noscript>
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="share.css">
    </noscript>
</head>
<body>
    <div class="container">
        <!-- 顶部标题区域优化 -->
        <header class="header">
            <h1>图片压缩工具</h1>
            <p>极速压缩图片，保持高质量效果，减小图片大小</p>
        </header>

        <!-- 在 header 下方或适当位置添加 -->
        <div class="pwa-install-button-container">
            <button id="manual-install-button" class="pwa-manual-install-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM12 3L7 8h4v8h2V8h4L12 3z"/>
                </svg>
                安装为应用
            </button>
        </div>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 上传区域 -->
            <div class="upload-section" id="upload-section">
                <div class="upload-area" id="upload-area">
                    <svg class="upload-icon" id="upload-icon" width="80" height="80" viewBox="0 0 24 24">
                        <use xlink:href="#icon-upload"></use>
                    </svg>
                    <p>拖放图片到这里或点击上传</p>
                    <p class="upload-hint">支持 PNG、JPG 等格式，可选择多个文件</p>
                    <input type="file" id="file-input" accept="image/*" multiple hidden>
                </div>
                <div class="button-group">
                    <button class="upload-button" id="upload-button">选择图片</button>
                    <button class="upload-button batch-mode-button" id="batch-mode-toggle">单图模式</button>
                </div>
            </div>
            
            <!-- 压缩比例建议按钮 -->
            <div class="tips-button-container">
                <button class="tips-button" id="compression-tips-button">
                    <svg class="tips-icon" width="16" height="16" viewBox="0 0 24 24"><use xlink:href="#icon-tips"></use></svg>
                    压缩比例建议
                </button>
            </div>

            <!-- 图片预览和压缩区域 -->
            <div class="preview-section" id="preview-section" hidden>
                <!-- 原图预览 -->
                <div class="preview-container">
                    <h2>原始图片</h2>
                    <div class="image-preview">
                        <img id="original-image" src="placeholder-image.svg" data-src="https://jelisos.github.io/image-compression-tool/bgz02.jpg" alt="原始图片">
                    </div>
                    <div class="image-info">
                        <p>文件大小: <span id="original-size">2.33 MB</span></p>
                        <p>尺寸: <span id="original-dimensions">5120 x 3200</span></p>
                    </div>
                </div>

                <!-- 压缩图片预览 -->
                <div class="preview-container">
                    <h2>压缩后图片</h2>
                    <div class="image-preview">
                        <img id="compressed-image" src="placeholder-image.svg" data-src="https://jelisos.github.io/image-compression-tool/bgz02.jpg" alt="压缩后图片">
                    </div>
                    <div class="image-info">
                        <p>文件大小: <span id="compressed-size">180.4 KB</span></p>
                        <p>尺寸: <span id="compressed-dimensions">1920 x 1200</span></p>
                        <p>压缩率: <span id="compression-ratio">92.45%</span></p>
                    </div>
                </div>
            </div>

            <!-- 压缩控制区域 -->
            <div class="compression-controls" id="compression-controls" hidden>
                <div class="slider-container">
                    <label for="quality-slider">压缩质量:</label>
                    <input type="range" id="quality-slider" min="0" max="100" value="75" class="slider">
                    <span id="quality-value">75%</span>
                </div>
                <div class="buttons-container">
                    <button id="compress-button" class="primary-button">压缩图片</button>
                    <button id="download-button" class="secondary-button" disabled>下载压缩图片</button>
                    <button id="download-all-button" class="secondary-button" disabled>批量下载</button>
                    <button id="share-button" class="share-button" disabled>
                        <svg class="share-icon" width="18" height="18" viewBox="0 0 24 24">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                        </svg>
                        分享
                    </button>
                    <button id="reset-button" class="tertiary-button">重新上传</button>
                    <button id="notify-button" class="notification-button">开启通知提醒</button>
                </div>
            </div>
            
            <!-- 批量处理区域 -->
            <div class="batch-processing-section" id="batch-processing-section" hidden>
                <h2>批量处理队列</h2>
                <div class="batch-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="batch-progress-bar"></div>
                    </div>
                    <div class="progress-info">
                        <span id="processed-count">0</span>/<span id="total-count">0</span> 已处理
                    </div>
                </div>
                <div class="batch-list" id="batch-list">
                    <!-- 批量处理的图片列表将在这里动态生成 -->
                </div>
            </div>
        </main>

        <!-- 压缩比例建议模态窗口 -->
        <div id="compression-tips-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>压缩比例建议</h2>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="tips-section">
                        <h3>照片类图片</h3>
                        <ul>
                            <li><strong>网站展示</strong>：60-80%质量，平衡视觉效果和加载速度</li>
                            <li><strong>社交媒体分享</strong>：70-85%质量，保持较好的视觉效果</li>
                            <li><strong>存档备份</strong>：85-95%质量，保留更多细节</li>
                        </ul>
                    </div>
                    
                    <div class="tips-section">
                        <h3>图表/UI元素</h3>
                        <ul>
                            <li><strong>简单图形和UI元素</strong>：50-70%质量，通常效果变化不明显</li>
                            <li><strong>复杂图表和信息图</strong>：75-85%质量，确保文字和细节清晰</li>
                        </ul>
                    </div>
                    
                    <div class="tips-section">
                        <h3>艺术作品/摄影作品</h3>
                        <ul>
                            <li><strong>作品展示</strong>：80-90%质量，保持艺术细节和色彩还原</li>
                            <li><strong>缩略图</strong>：40-60%质量，仅用于预览</li>
                        </ul>
                    </div>
                    
                    <div class="tips-section">
                        <h3>保真阈值指南</h3>
                        <ul>
                            <li><strong>75%质量</strong>：大多数场景下的推荐默认值，平衡文件大小和图片质量</li>
                            <li><strong>85%质量</strong>：高质量阈值，超过此值文件大小增加显著但质量提升不明显</li>
                            <li><strong>60%质量</strong>：可接受的最低阈值，低于此值图片质量通常会有明显下降</li>
                        </ul>
                    </div>
                    
                    <div class="tips-section">
                        <h3>优化建议</h3>
                        <ul>
                            <li>根据图片最终使用尺寸调整分辨率，再进行压缩效果更佳</li>
                            <li>对于需要透明背景的图片，优先选择PNG格式</li>
                            <li>对于照片类图片，优先选择JPG格式并适当压缩</li>
                            <li>压缩前备份原图，以便需要时重新处理</li>
                        </ul>
                    </div>
            <!-- 添加FAQ部分 -->
            <div class="faq-section">
                <h3>常见问题</h3>
                <details>
                    <summary>Jelisos图片压缩工具是否收费？</summary>
                    <p>Jelisos提供完全免费的图片压缩服务，您可以无限制使用，无需注册或付费。</p>
                    &nbsp;
                </details>
                <details>
                    <summary>如何批量压缩多张图片？</summary>
                    <p>点击"选择图片"按钮上传多张图片，或切换到"批量模式"，即可同时处理多张图片并批量下载。</p>
                    &nbsp;
                </details>
                <details>
                    <summary>压缩速度和图片质量如何？</summary>
                    <p>Jelisos采用极速压缩算法，在快速处理的同时，通过质量滑块可灵活调整压缩比例，确保输出高质量图片。</p>
                    &nbsp;
                </details>
                <details>
                    <summary>我的图片会上传到服务器吗？</summary>
                    <p>不会。Jelisos是纯浏览器端应用，所有处理都在您的设备上完成，图片不会上传到任何服务器，保障您的隐私安全。</p>
                </details>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 分享模态窗口 -->
        <div id="share-modal" class="share-modal">
            <div class="share-modal-content">
                <div class="share-modal-header">
                    <h2>分享压缩后的图片</h2>
                    <span class="close-share-modal">&times;</span>
                </div>
                <div class="share-modal-body">
                    <div class="share-image-preview">
                        <img id="share-preview-image" src="https://jelisos.github.io/image-compression-tool/bgz02.jpg" alt="分享预览图">
                    </div>
                    
                    <h3>选择分享平台</h3>
                    <div class="share-platforms">
                        <!-- 国内社交平台 -->
                        <div id="wechat-share" class="share-platform">
                            <div class="platform-icon wechat">
                                <img src="icons/wechat.svg" alt="微信">
                            </div>
                            <div class="platform-name">微信</div>
                        </div>
                        <div id="weibo-share" class="share-platform">
                            <div class="platform-icon weibo">
                                <img src="icons/weibo.svg" alt="微博">
                            </div>
                            <div class="platform-name">微博</div>
                        </div>
                        <div id="qq-share" class="share-platform">
                            <div class="platform-icon qq">
                                <img src="icons/qq.svg" alt="QQ">
                            </div>
                            <div class="platform-name">QQ</div>
                        </div>
                        
                        <!-- 国外社交平台 -->
                        <div id="facebook-share" class="share-platform">
                            <div class="platform-icon facebook">
                                <img src="icons/facebook.svg" alt="Facebook">
                            </div>
                            <div class="platform-name">Facebook</div>
                        </div>
                        <div id="twitter-share" class="share-platform">
                            <div class="platform-icon twitter">
                                <img src="icons/twitter.svg" alt="Twitter">
                            </div>
                            <div class="platform-name">Twitter</div>
                        </div>
                        <div id="instagram-share" class="share-platform">
                            <div class="platform-icon instagram">
                                <img src="icons/instagram.svg" alt="Instagram">
                            </div>
                            <div class="platform-name">Instagram</div>
                        </div>
                    </div>
                    
                    <!-- 微信二维码区域 -->
                    <div id="wechat-qrcode-container" class="wechat-qrcode-container">
                        <div class="wechat-qrcode-title">微信扫码分享</div>
                        <div id="wechat-qrcode"></div>
                        <p class="qrcode-hint">打开微信扫一扫，将本站分享给好友</p>
                    </div>
                    
                    <div class="copy-link-section">
                        <h3>复制本站链接</h3>
                        <div class="copy-link-container">
                            <input type="text" id="copy-link-input" readonly>
                            <button id="copy-link-button" class="copy-button">复制</button>
                        </div>
                        <p id="copy-success-message" class="copy-success-message">链接已复制!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 添加结构化数据 -->
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "WebApplication",
          "name": "Jelisos - 免费批量图片压缩工具",
          "description": "提供免费批量图片压缩服务，极速处理，保持高质量效果。在浏览器中压缩图片，保护隐私。",
          "url": "https://jelisos.github.io/image-compression-tool/",
          "applicationCategory": "UtilityApplication",
          "operatingSystem": "All",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
          }
        }
        </script>
    </div>

    <!-- SVG图标定义 -->
    <svg style="display: none;">
        <symbol id="icon-upload" viewBox="0 0 24 24">
            <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
        </symbol>
        <symbol id="icon-tips" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
        </symbol>
        <symbol id="icon-share" viewBox="0 0 24 24">
            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
        </symbol>
    </svg>

    <!-- 优化 JavaScript 加载 -->
    <script src="libs/browser-image-compression.min.js" defer></script>
    <script src="libs/jszip.min.js" defer></script>
    <script src="libs/FileSaver.min.js" defer></script>
    <script src="script.js" defer></script>
    <script src="share.js" defer></script>
    <script src="notifications.js" defer></script>
    
    <!-- 注册服务工作线程 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker 注册成功，作用域：', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker 注册失败：', error);
                    });
            });
        }
    </script>

        <!-- 底部信息区域增加关键词 -->
        <footer class="footer">
            <p>© 2025 Jelisos 图片压缩工具 - 在浏览器中免费批量极速压缩图片，保持高质量，保护您的隐私</p>
            <script>
                var _hmt = _hmt || [];
                (function() {
                  var hm = document.createElement("script");
                  hm.src = "https://hm.baidu.com/hm.js?5e32de3acc33aa16839f18f512a2dd88";
                  var s = document.getElementsByTagName("script")[0]; 
                  s.parentNode.insertBefore(hm, s);
                })();
                </script>
        </footer>

    <!-- 添加PWA安装提示 -->
    <div id="pwa-install-container" class="pwa-install-container" hidden>
        <div class="pwa-install-prompt">
            <p>将Jelisos图片压缩工具添加到主屏幕，随时使用</p>
            <div class="pwa-install-buttons">
                <button id="pwa-install-button" class="pwa-install-yes">安装</button>
                <button id="pwa-install-cancel" class="pwa-install-no">暂不</button>
            </div>
        </div>
    </div>

    <!-- 加载脚本 -->
    <script>
        // 处理PWA安装提示
        let deferredPrompt;
        const pwaInstallContainer = document.getElementById('pwa-install-container');
        const pwaInstallButton = document.getElementById('pwa-install-button');
        const pwaInstallCancel = document.getElementById('pwa-install-cancel');

        window.addEventListener('beforeinstallprompt', (e) => {
            // 阻止Chrome 67及更早版本自动显示安装提示
            e.preventDefault();
            // 保存事件，以便稍后触发
            deferredPrompt = e;
            // 显示自定义安装提示
            pwaInstallContainer.hidden = false;
        });

        pwaInstallButton.addEventListener('click', () => {
            // 隐藏安装提示
            pwaInstallContainer.hidden = true;
            // 显示安装提示
            deferredPrompt.prompt();
            // 等待用户响应安装提示
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('用户接受了安装');
                } else {
                    console.log('用户取消了安装');
                }
                deferredPrompt = null;
            });
        });

        pwaInstallCancel.addEventListener('click', () => {
            // 隐藏安装提示
            pwaInstallContainer.hidden = true;
        });

        // 检测PWA是否已安装
        window.addEventListener('appinstalled', (evt) => {
            console.log('应用已安装');
            pwaInstallContainer.hidden = true;
        });

        // 手动安装按钮逻辑
        const manualInstallButton = document.getElementById('manual-install-button');
        if (manualInstallButton) {
            // 默认隐藏按钮，当可安装时才显示
            manualInstallButton.style.display = 'none';
            
            window.addEventListener('beforeinstallprompt', (e) => {
                // 显示手动安装按钮
                manualInstallButton.style.display = 'flex';
                
                manualInstallButton.addEventListener('click', () => {
                    // 显示安装提示
                    e.prompt();
                    // 等待用户响应
                    e.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('用户通过手动按钮安装了应用');
                            manualInstallButton.style.display = 'none';
                        }
                        deferredPrompt = null;
                    });
                });
            });
            
            // 如果已经安装，则隐藏按钮
            window.addEventListener('appinstalled', () => {
                manualInstallButton.style.display = 'none';
            });
        }
    </script>

    <!-- 在其他脚本之后引用 -->
    <script src="pwa-updater.js"></script>

    <!-- 在页面底部添加这段调试代码 -->
    <script>
        console.log('PWA 检查开始...');
        
        // 检查 manifest.json
        fetch('manifest.json')
            .then(response => {
                if (response.ok) {
                    console.log('✅ manifest.json 加载成功');
                } else {
                    console.error('❌ manifest.json 加载失败');
                }
            })
            .catch(error => {
                console.error('❌ manifest.json 加载错误:', error);
            });
        
        // 检查 service worker 支持
        if ('serviceWorker' in navigator) {
            console.log('✅ 浏览器支持 Service Worker');
        } else {
            console.error('❌ 浏览器不支持 Service Worker');
        }
        
        // 检查安装事件
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('✅ beforeinstallprompt 事件触发');
        });
        
        // 检查显示模式
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('应用已经以 standalone 模式运行');
        }
    </script>
</body>
</html>